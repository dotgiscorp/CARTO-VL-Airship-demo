{"ast":null,"code":"export function applyPolyfill(window, document) {\n  /*! https://github.com/WebReflection/es6-collections\n  (C) Andrea Giammarchi - @WebReflection - Mit Style License */\n  (function (e) {\n    function d(a, b) {\n      function c(a) {\n        if (!this || this.constructor !== c) return new c(a);\n        this._keys = [];\n        this._values = [];\n        this._itp = [];\n        this.objectOnly = b;\n        a && v.call(this, a);\n      }\n\n      b || w(a, \"size\", {\n        get: x\n      });\n      a.constructor = c;\n      c.prototype = a;\n      return c;\n    }\n\n    function v(a) {\n      this.add ? a.forEach(this.add, this) : a.forEach(function (a) {\n        this.set(a[0], a[1]);\n      }, this);\n    }\n\n    function f(a) {\n      this.has(a) && (this._keys.splice(c, 1), this._values.splice(c, 1), this._itp.forEach(function (a) {\n        c < a[0] && a[0]--;\n      }));\n      return -1 < c;\n    }\n\n    function m(a) {\n      return this.has(a) ? this._values[c] : void 0;\n    }\n\n    function n(a, b) {\n      if (this.objectOnly && b !== Object(b)) throw new TypeError(\"Invalid value used as weak collection key\");\n      if (b != b || 0 === b) for (c = a.length; c-- && !y(a[c], b););else c = a.indexOf(b);\n      return -1 < c;\n    }\n\n    function p(a) {\n      return n.call(this, this._values, a);\n    }\n\n    function q(a) {\n      return n.call(this, this._keys, a);\n    }\n\n    function r(a, b) {\n      this.has(a) ? this._values[c] = b : this._values[this._keys.push(a) - 1] = b;\n      return this;\n    }\n\n    function t(a) {\n      this.has(a) || this._values.push(a);\n      return this;\n    }\n\n    function h() {\n      (this._keys || 0).length = this._values.length = 0;\n    }\n\n    function z() {\n      return k(this._itp, this._keys);\n    }\n\n    function l() {\n      return k(this._itp, this._values);\n    }\n\n    function A() {\n      return k(this._itp, this._keys, this._values);\n    }\n\n    function B() {\n      return k(this._itp, this._values, this._values);\n    }\n\n    function k(a, b, c) {\n      var g = [0],\n          e = !1;\n      a.push(g);\n      return {\n        next: function () {\n          var d = g[0];\n\n          if (!e && d < b.length) {\n            var f = c ? [b[d], c[d]] : b[d];\n            g[0]++;\n          } else e = !0, a.splice(a.indexOf(g), 1);\n\n          return {\n            done: e,\n            value: f\n          };\n        }\n      };\n    }\n\n    function x() {\n      return this._values.length;\n    }\n\n    function u(a, b) {\n      for (var c = this.entries();;) {\n        var d = c.next();\n        if (d.done) break;\n        a.call(b, d.value[1], d.value[0], this);\n      }\n    }\n\n    var c,\n        w = Object.defineProperty,\n        y = function (a, b) {\n      return a === b || a !== a && b !== b;\n    };\n\n    \"undefined\" == typeof WeakMap && (e.WeakMap = d({\n      \"delete\": f,\n      clear: h,\n      get: m,\n      has: q,\n      set: r\n    }, !0));\n    \"undefined\" != typeof Map && \"function\" === typeof new Map().values && new Map().values().next || (e.Map = d({\n      \"delete\": f,\n      has: q,\n      get: m,\n      set: r,\n      keys: z,\n      values: l,\n      entries: A,\n      forEach: u,\n      clear: h\n    }));\n    \"undefined\" != typeof Set && \"function\" === typeof new Set().values && new Set().values().next || (e.Set = d({\n      has: p,\n      add: t,\n      \"delete\": f,\n      clear: h,\n      keys: l,\n      values: l,\n      entries: B,\n      forEach: u\n    }));\n    \"undefined\" == typeof WeakSet && (e.WeakSet = d({\n      \"delete\": f,\n      add: t,\n      clear: h,\n      has: p\n    }, !0));\n  })(window);\n\n  var StyleNode = function () {\n    return function () {\n      this.start = 0, this.end = 0, this.previous = null, this.parent = null, this.rules = null, this.parsedCssText = \"\", this.cssText = \"\", this.atRule = !1, this.type = 0, this.keyframesName = \"\", this.selector = \"\", this.parsedSelector = \"\";\n    };\n  }();\n\n  function parse(e) {\n    return parseCss(lex(e = clean(e)), e);\n  }\n\n  function clean(e) {\n    return e.replace(RX.comments, \"\").replace(RX.port, \"\");\n  }\n\n  function lex(e) {\n    var t = new StyleNode();\n    t.start = 0, t.end = e.length;\n\n    for (var r = t, n = 0, s = e.length; n < s; n++) if (e[n] === OPEN_BRACE) {\n      r.rules || (r.rules = []);\n      var a = r,\n          o = a.rules[a.rules.length - 1] || null;\n      (r = new StyleNode()).start = n + 1, r.parent = a, r.previous = o, a.rules.push(r);\n    } else e[n] === CLOSE_BRACE && (r.end = n + 1, r = r.parent || t);\n\n    return t;\n  }\n\n  function parseCss(e, t) {\n    var r = t.substring(e.start, e.end - 1);\n\n    if (e.parsedCssText = e.cssText = r.trim(), e.parent) {\n      var n = e.previous ? e.previous.end : e.parent.start;\n      r = (r = (r = _expandUnicodeEscapes(r = t.substring(n, e.start - 1))).replace(RX.multipleSpaces, \" \")).substring(r.lastIndexOf(\";\") + 1);\n      var s = e.parsedSelector = e.selector = r.trim();\n      e.atRule = 0 === s.indexOf(AT_START), e.atRule ? 0 === s.indexOf(MEDIA_START) ? e.type = types.MEDIA_RULE : s.match(RX.keyframesRule) && (e.type = types.KEYFRAMES_RULE, e.keyframesName = e.selector.split(RX.multipleSpaces).pop()) : 0 === s.indexOf(VAR_START) ? e.type = types.MIXIN_RULE : e.type = types.STYLE_RULE;\n    }\n\n    var a = e.rules;\n    if (a) for (var o = 0, i = a.length, l = void 0; o < i && (l = a[o]); o++) parseCss(l, t);\n    return e;\n  }\n\n  function _expandUnicodeEscapes(e) {\n    return e.replace(/\\\\([0-9a-f]{1,6})\\s/gi, function () {\n      for (var e = arguments[1], t = 6 - e.length; t--;) e = \"0\" + e;\n\n      return \"\\\\\" + e;\n    });\n  }\n\n  var types = {\n    STYLE_RULE: 1,\n    KEYFRAMES_RULE: 7,\n    MEDIA_RULE: 4,\n    MIXIN_RULE: 1e3\n  },\n      OPEN_BRACE = \"{\",\n      CLOSE_BRACE = \"}\",\n      RX = {\n    comments: /\\/\\*[^*]*\\*+([^\\/*][^*]*\\*+)*\\//gim,\n    port: /@import[^;]*;/gim,\n    customProp: /(?:^[^;\\-\\s}]+)?--[^;{}]*?:[^{};]*?(?:[;\\n]|$)/gim,\n    mixinProp: /(?:^[^;\\-\\s}]+)?--[^;{}]*?:[^{};]*?{[^}]*?}(?:[;\\n]|$)?/gim,\n    mixinApply: /@apply\\s*\\(?[^);]*\\)?\\s*(?:[;\\n]|$)?/gim,\n    varApply: /[^;:]*?:[^;]*?var\\([^;]*\\)(?:[;\\n]|$)?/gim,\n    keyframesRule: /^@[^\\s]*keyframes/,\n    multipleSpaces: /\\s+/g\n  },\n      VAR_START = \"--\",\n      MEDIA_START = \"@media\",\n      AT_START = \"@\";\n\n  function findRegex(e, t, r) {\n    e.lastIndex = 0;\n    var n = t.substring(r).match(e);\n\n    if (n) {\n      var s = r + n.index;\n      return {\n        start: s,\n        end: s + n[0].length\n      };\n    }\n\n    return null;\n  }\n\n  var VAR_USAGE_START = /\\bvar\\(/,\n      VAR_ASSIGN_START = /\\B--[\\w-]+\\s*:/,\n      COMMENTS = /\\/\\*[^*]*\\*+([^\\/*][^*]*\\*+)*\\//gim,\n      TRAILING_LINES = /^[\\t ]+\\n/gm;\n\n  function resolveVar(e, t, r) {\n    return e[t] ? e[t] : r ? executeTemplate(r, e) : \"\";\n  }\n\n  function findVarEndIndex(e, t) {\n    for (var r = 0, n = t; n < e.length; n++) {\n      var s = e[n];\n      if (\"(\" === s) r++;else if (\")\" === s && --r <= 0) return n + 1;\n    }\n\n    return n;\n  }\n\n  function parseVar(e, t) {\n    var r = findRegex(VAR_USAGE_START, e, t);\n    if (!r) return null;\n    var n = findVarEndIndex(e, r.start),\n        s = e.substring(r.end, n - 1).split(\",\"),\n        a = s[0],\n        o = s.slice(1);\n    return {\n      start: r.start,\n      end: n,\n      propName: a.trim(),\n      fallback: o.length > 0 ? o.join(\",\").trim() : void 0\n    };\n  }\n\n  function compileVar(e, t, r) {\n    var n = parseVar(e, r);\n    if (!n) return t.push(e.substring(r, e.length)), e.length;\n    var s = n.propName,\n        a = null != n.fallback ? compileTemplate(n.fallback) : void 0;\n    return t.push(e.substring(r, n.start), function (e) {\n      return resolveVar(e, s, a);\n    }), n.end;\n  }\n\n  function executeTemplate(e, t) {\n    for (var r = \"\", n = 0; n < e.length; n++) {\n      var s = e[n];\n      r += \"string\" == typeof s ? s : s(t);\n    }\n\n    return r;\n  }\n\n  function findEndValue(e, t) {\n    for (var r = !1, n = !1, s = t; s < e.length; s++) {\n      var a = e[s];\n      if (r) n && '\"' === a && (r = !1), n || \"'\" !== a || (r = !1);else if ('\"' === a) r = !0, n = !0;else if (\"'\" === a) r = !0, n = !1;else {\n        if (\";\" === a) return s + 1;\n        if (\"}\" === a) return s;\n      }\n    }\n\n    return s;\n  }\n\n  function removeCustomAssigns(e) {\n    for (var t = \"\", r = 0;;) {\n      var n = findRegex(VAR_ASSIGN_START, e, r),\n          s = n ? n.start : e.length;\n      if (t += e.substring(r, s), !n) break;\n      r = findEndValue(e, s);\n    }\n\n    return t;\n  }\n\n  function compileTemplate(e) {\n    var t = 0;\n    e = removeCustomAssigns(e = e.replace(COMMENTS, \"\")).replace(TRAILING_LINES, \"\");\n\n    for (var r = []; t < e.length;) t = compileVar(e, r, t);\n\n    return r;\n  }\n\n  function resolveValues(e) {\n    var t = {};\n    e.forEach(function (e) {\n      e.declarations.forEach(function (e) {\n        t[e.prop] = e.value;\n      });\n    });\n\n    for (var r = {}, n = Object.entries(t), s = function (e) {\n      var t = !1;\n      if (n.forEach(function (e) {\n        var n = e[0],\n            s = executeTemplate(e[1], r);\n        s !== r[n] && (r[n] = s, t = !0);\n      }), !t) return \"break\";\n    }, a = 0; a < 10; a++) {\n      if (\"break\" === s()) break;\n    }\n\n    return r;\n  }\n\n  function getSelectors(e, t) {\n    if (void 0 === t && (t = 0), !e.rules) return [];\n    var r = [];\n    return e.rules.filter(function (e) {\n      return e.type === types.STYLE_RULE;\n    }).forEach(function (e) {\n      var n = getDeclarations(e.cssText);\n      n.length > 0 && e.parsedSelector.split(\",\").forEach(function (e) {\n        e = e.trim(), r.push({\n          selector: e,\n          declarations: n,\n          specificity: computeSpecificity(e),\n          nu: t\n        });\n      }), t++;\n    }), r;\n  }\n\n  function computeSpecificity(e) {\n    return 1;\n  }\n\n  var IMPORTANT = \"!important\",\n      FIND_DECLARATIONS = /(?:^|[;\\s{]\\s*)(--[\\w-]*?)\\s*:\\s*(?:((?:'(?:\\\\'|.)*?'|\"(?:\\\\\"|.)*?\"|\\([^)]*?\\)|[^};{])+)|\\{([^}]*)\\}(?:(?=[;\\s}])|$))/gm;\n\n  function getDeclarations(e) {\n    for (var t, r = []; t = FIND_DECLARATIONS.exec(e.trim());) {\n      var n = normalizeValue(t[2]),\n          s = n.value,\n          a = n.important;\n      r.push({\n        prop: t[1].trim(),\n        value: compileTemplate(s),\n        important: a\n      });\n    }\n\n    return r;\n  }\n\n  function normalizeValue(e) {\n    var t = (e = e.replace(/\\s+/gim, \" \").trim()).endsWith(IMPORTANT);\n    return t && (e = e.substr(0, e.length - IMPORTANT.length).trim()), {\n      value: e,\n      important: t\n    };\n  }\n\n  function getActiveSelectors(e, t, r) {\n    return sortSelectors(getSelectorsForScopes(r.concat(getScopesForElement(t, e))).filter(function (t) {\n      return matches(e, t.selector);\n    }));\n  }\n\n  function getScopesForElement(e, t) {\n    for (var r = []; t;) {\n      var n = e.get(t);\n      n && r.push(n), t = t.parentElement;\n    }\n\n    return r;\n  }\n\n  function getSelectorsForScopes(e) {\n    var t = [];\n    return e.forEach(function (e) {\n      t.push.apply(t, e.selectors);\n    }), t;\n  }\n\n  function sortSelectors(e) {\n    return e.sort(function (e, t) {\n      return e.specificity === t.specificity ? e.nu - t.nu : e.specificity - t.specificity;\n    }), e;\n  }\n\n  function matches(e, t) {\n    return e.matches(t);\n  }\n\n  function parseCSS(e) {\n    var t = parse(e),\n        r = compileTemplate(e);\n    return {\n      original: e,\n      template: r,\n      selectors: getSelectors(t),\n      isDynamic: r.length > 1\n    };\n  }\n\n  function addGlobalStyle(e, t) {\n    var r = parseCSS(t.innerHTML);\n    r.styleEl = t, e.push(r);\n  }\n\n  function updateGlobalScopes(e) {\n    var t = resolveValues(getSelectorsForScopes(e));\n    e.forEach(function (e) {\n      e.isDynamic && (e.styleEl.innerHTML = executeTemplate(e.template, t));\n    });\n  }\n\n  function reScope(e, t) {\n    var r = e.template.map(function (r) {\n      return \"string\" == typeof r ? replaceScope(r, e.cssScopeId, t) : r;\n    }),\n        n = e.selectors.map(function (r) {\n      return Object.assign({}, r, {\n        selector: replaceScope(r.selector, e.cssScopeId, t)\n      });\n    });\n    return Object.assign({}, e, {\n      template: r,\n      selectors: n,\n      cssScopeId: t\n    });\n  }\n\n  function replaceScope(e, t, r) {\n    return e = replaceAll(e, \"\\\\.\" + t, \".\" + r);\n  }\n\n  function replaceAll(e, t, r) {\n    return e.replace(new RegExp(t, \"g\"), r);\n  }\n\n  function loadDocument(e, t) {\n    return loadDocumentLinks(e, t).then(function () {\n      loadDocumentStyles(e, t);\n    });\n  }\n\n  function loadDocumentLinks(e, t) {\n    for (var r = [], n = e.querySelectorAll('link[rel=\"stylesheet\"][href]'), s = 0; s < n.length; s++) r.push(addGlobalLink(e, t, n[s]));\n\n    return Promise.all(r);\n  }\n\n  function loadDocumentStyles(e, t) {\n    for (var r = e.querySelectorAll(\"style\"), n = 0; n < r.length; n++) addGlobalStyle(t, r[n]);\n  }\n\n  function addGlobalLink(e, t, r) {\n    var n = r.href;\n    return fetch(n).then(function (e) {\n      return e.text();\n    }).then(function (s) {\n      if (hasCssVariables(s) && r.parentNode) {\n        hasRelativeUrls(s) && (s = fixRelativeUrls(s, n));\n        var a = e.createElement(\"style\");\n        a.innerHTML = s, addGlobalStyle(t, a), r.parentNode.insertBefore(a, r), r.remove();\n      }\n    }).catch(function (e) {\n      console.error(e);\n    });\n  }\n\n  var CSS_VARIABLE_REGEXP = /[\\s;{]--[-a-zA-Z0-9]+\\s*:/m;\n\n  function hasCssVariables(e) {\n    return e.indexOf(\"var(\") > -1 || CSS_VARIABLE_REGEXP.test(e);\n  }\n\n  var CSS_URL_REGEXP = /url[\\s]*\\([\\s]*['\"]?(?![http|\\/])([^\\'\\\"\\)]*)[\\s]*['\"]?\\)[\\s]*/gim;\n\n  function hasRelativeUrls(e) {\n    return CSS_URL_REGEXP.lastIndex = 0, CSS_URL_REGEXP.test(e);\n  }\n\n  function fixRelativeUrls(e, t) {\n    var r = t.replace(/[^\\/]*$/, \"\");\n    return e.replace(CSS_URL_REGEXP, function (e, t) {\n      var n = r + t;\n      return e.replace(t, n);\n    });\n  }\n\n  var CustomStyle = function () {\n    function e(e, t) {\n      this.win = e, this.doc = t, this.count = 0, this.hostStyleMap = new WeakMap(), this.hostScopeMap = new WeakMap(), this.globalScopes = [], this.scopesMap = new Map();\n    }\n\n    return e.prototype.initShim = function () {\n      var e = this;\n      return new Promise(function (t) {\n        e.win.requestAnimationFrame(function () {\n          loadDocument(e.doc, e.globalScopes).then(function () {\n            return t();\n          });\n        });\n      });\n    }, e.prototype.addLink = function (e) {\n      var t = this;\n      return addGlobalLink(this.doc, this.globalScopes, e).then(function () {\n        t.updateGlobal();\n      });\n    }, e.prototype.addGlobalStyle = function (e) {\n      addGlobalStyle(this.globalScopes, e), this.updateGlobal();\n    }, e.prototype.createHostStyle = function (e, t, r) {\n      if (this.hostScopeMap.has(e)) return null;\n      var n = e[\"s-sc\"],\n          s = this.registerHostTemplate(r, t, n),\n          a = s.isDynamic && s.cssScopeId;\n      if (!(a || !s.styleEl)) return null;\n      var o = this.doc.createElement(\"style\");\n\n      if (a) {\n        var i = s.cssScopeId + \"-\" + this.count;\n        e[\"s-sc\"] = i, this.hostStyleMap.set(e, o), this.hostScopeMap.set(e, reScope(s, i)), this.count++;\n      } else s.styleEl = o, s.isDynamic || (o.innerHTML = executeTemplate(s.template, {})), this.globalScopes.push(s), this.updateGlobal(), this.hostScopeMap.set(e, s);\n\n      return o;\n    }, e.prototype.removeHost = function (e) {\n      var t = this.hostStyleMap.get(e);\n      t && t.remove(), this.hostStyleMap.delete(e), this.hostScopeMap.delete(e);\n    }, e.prototype.updateHost = function (e) {\n      var t = this.hostScopeMap.get(e);\n\n      if (t && t.isDynamic && t.cssScopeId) {\n        var r = this.hostStyleMap.get(e);\n\n        if (r) {\n          var n = resolveValues(getActiveSelectors(e, this.hostScopeMap, this.globalScopes));\n          r.innerHTML = executeTemplate(t.template, n);\n        }\n      }\n    }, e.prototype.updateGlobal = function () {\n      updateGlobalScopes(this.globalScopes);\n    }, e.prototype.registerHostTemplate = function (e, t, r) {\n      var n = this.scopesMap.get(t);\n      return n || ((n = parseCSS(e)).cssScopeId = r, this.scopesMap.set(t, n)), n;\n    }, e;\n  }();\n\n  window.customStyleShim = new CustomStyle(window, document);\n}","map":null,"metadata":{},"sourceType":"module"}